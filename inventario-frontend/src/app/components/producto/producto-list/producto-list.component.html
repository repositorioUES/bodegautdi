<div class="container mt-5">

    <div class="d-flex align-items-center gap-3 mb-4">

    <button mat-icon-button class="bg-white shadow-sm text-dark" routerLink="/catalogos">
        <mat-icon>arrow_back</mat-icon>
    </button>
        
    <div>
        <h6 class="text-uppercase text-muted mb-1" style="font-size: 0.8rem; letter-spacing: 1px;">Módulo de Inventario</h6>
        <h2 class="fw-bold text-dark m-0">Catálogo de Productos</h2>
    </div>

    <div class="d-flex flex-column align-items-end ms-auto gap-2">
        
        <button mat-raised-button class="rounded-pill px-4 btn-nuevo" (click)="abrirFormulario()">
            <mat-icon class="me-2">inventory_2</mat-icon> Nuevo Producto
        </button>

        <mat-form-field appearance="outline" subscriptSizing="dynamic" class="density-compact" style="width: 350px; font-size: 0.9rem;">
            <mat-label>Buscar producto...</mat-label>
            <input matInput (keyup)="applyFilter($event)" placeholder="Ej. Laptop" #input autocomplete="off">
            <mat-icon matSuffix class="text-secondary">search</mat-icon>
        </mat-form-field>

    </div>
</div>


  <mat-card class="custom-card">
      <table mat-table [dataSource]="dataSource" class="w-100">

          <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef class="ps-4"> N° </th>
              <td mat-cell *matCellDef="let element; let i = index" class="ps-4 text-secondary"> 
                  #{{ i + 1 }} 
              </td>
          </ng-container>

          <ng-container matColumnDef="sku">
              <th mat-header-cell *matHeaderCellDef> SKU </th>
              <td mat-cell *matCellDef="let element"> 
                  <div class="d-flex align-items-center">
                      <span class="badge bg-light text-dark border font-monospace" style="font-size: 0.85rem; letter-spacing: 1px;">
                          {{element.skuproducto}}
                      </span>
                  </div>
              </td>
          </ng-container>

          <ng-container matColumnDef="nombre">
              <th mat-header-cell *matHeaderCellDef> Producto </th>
              <td mat-cell *matCellDef="let element"> 
                  <div class="d-flex align-items-center py-2">

                      
                      <div class="d-flex flex-column">
                          <span class="fw-bold text-dark">{{element.nombreproducto}}</span>
                          <div class="d-flex align-items-center mt-1">
                              <mat-icon class="text-muted me-1" style="font-size: 14px; width: 14px; height: 14px;">tag</mat-icon>
                              <small class="text-secondary">{{element.unidadMedida?.nombreunidadmedida}}</small>
                          </div>
                      </div>
                  </div>
              </td>
          </ng-container>

          <ng-container matColumnDef="precios">
              <th mat-header-cell *matHeaderCellDef> Costo </th>
              <td mat-cell *matCellDef="let element"> 
                  <div class="d-flex align-items-center">
                      <div class="d-flex align-items-center px-2 py-1 rounded bg-success-subtle text-success border border-success-subtle">
                          <mat-icon style="font-size: 16px; width: 16px; height: 16px;" class="me-1">attach_money</mat-icon>
                          <span class="fw-bold">{{element.preciocostoproducto | number:'1.2-2'}}</span>
                      </div>
                  </div>
              </td>
          </ng-container>

          <ng-container matColumnDef="proveedor">
              <th mat-header-cell *matHeaderCellDef> Proveedor </th>
              <td mat-cell *matCellDef="let element" class="text-secondary"> 
                  <div class="d-flex align-items-center">
                      <mat-icon class="me-2 text-muted" style="font-size: 18px; width: 18px; height: 18px;">local_shipping</mat-icon>
                      {{element.proveedor?.nombreproveedor}} 
                  </div>
              </td>
          </ng-container>

          <ng-container matColumnDef="acciones">
              <th mat-header-cell *matHeaderCellDef class="text-center pe-4"> Acciones </th>
              <td mat-cell *matCellDef="let element" class="col-acciones">
                  
                <button mat-icon-button  color="primary" class="action-btn" matTooltip="Editar Producto">
                  <mat-icon>edit_note</mat-icon> </button>
                  
                  <button mat-icon-button class="action-btn delete" matTooltip="Eliminar Producto" (click)="eliminar(element.idProducto)">
                      <mat-icon>delete_outline</mat-icon>
                  </button>

              </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover-row"></tr>

          <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell text-center py-5" colspan="6">
                  <div class="d-flex flex-column align-items-center justify-content-center text-muted">
                      <mat-icon style="font-size: 45px; width: 45px; height: 45px;" class="mb-2">inventory_2</mat-icon>
                      <span class="fw-medium">No se encontraron productos</span>

                      @if (input.value){
                          <small class="text-muted mt-1">Para la búsqueda "{{input.value}}"</small>
                        }
                  </div>
              </td>
          </tr>

      </table>

      <mat-paginator [pageSizeOptions]="[10, 25, 50]"
                     showFirstLastButtons
                     aria-label="Seleccionar página">
      </mat-paginator>

  </mat-card>
</div>